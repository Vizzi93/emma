# ============================================================
# eMMA Backend Configuration
# ============================================================
# Copy this file to .env and adjust values for your environment.
# Never commit .env to version control!
# ============================================================

# === Environment ===
# Options: development, staging, production
ENVIRONMENT=development

# Enable debug mode (NEVER set to true in production!)
DEBUG=false

# === Database ===
# PostgreSQL (recommended for production):
# DATABASE_URL=postgresql+asyncpg://emma:secretpassword@localhost:5432/emma

# SQLite (development only):
DATABASE_URL=sqlite+aiosqlite:///./emma.db

# Connection pool settings (PostgreSQL only)
DB_POOL_SIZE=5
DB_POOL_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30

# === Security ===
# Generate with: openssl rand -hex 32
SECRET_KEY=change-me-in-production-use-openssl-rand-hex-32

# === JWT Authentication ===
# Secret key for JWT tokens (generate with: openssl rand -hex 32)
JWT_SECRET_KEY=change-me-jwt-secret-minimum-32-characters

# Access token expiry in minutes (default: 30)
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Refresh token expiry in days (default: 7)
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS allowed origins (comma-separated)
# Development: http://localhost:3000
# Production: https://emma.dojaflow.ai
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# Allowed Host headers (comma-separated, use specific hosts in production)
ALLOWED_HOSTS=*

# === Rate Limiting ===
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# === Agent Provisioning ===
# How long enrollment tokens remain valid (hours)
ENROLLMENT_TOKEN_TTL_HOURS=24

# How long download tokens remain valid (minutes)
DOWNLOAD_TOKEN_TTL_MINUTES=10

# Base URL where agent binaries are served
AGENT_BINARY_BASE_URL=https://downloads.emma.dojaflow.ai

# === JWT Configuration Signing ===
# Key ID included in JWT header (for key rotation)
CONFIG_SIGNING_KEY_ID=emma-config-v1

# Option A: Path to PEM private key file
# CONFIG_SIGNING_KEY_PATH=/etc/emma/keys/config-signing.pem

# Option B: PEM private key content (use ONLY for development/testing)
# For production, use CONFIG_SIGNING_KEY_PATH or secrets manager
# CONFIG_SIGNING_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"

# === Logging ===
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log format: json (production) or console (development)
LOG_FORMAT=console

# === Observability (Optional) ===
# Sentry DSN for error tracking (leave empty to disable)
# SENTRY_DSN=https://xxx@sentry.io/123

# === API Configuration ===
API_V1_PREFIX=/v1
API_TITLE=eMMA Monitoring API
API_VERSION=1.0.0

# ============================================================
# Quick Start Commands
# ============================================================
#
# 1. Generate RSA key pair for JWT signing:
#    openssl genrsa -out config-signing.pem 2048
#    openssl rsa -in config-signing.pem -pubout -out config-signing.pub.pem
#
# 2. Generate secret key:
#    openssl rand -hex 32
#
# 3. Run database migrations:
#    alembic upgrade head
#
# 4. Start development server:
#    uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
#
# ============================================================
